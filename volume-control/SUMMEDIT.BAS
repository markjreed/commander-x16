#CONTROLCODES 1
#INCLUDE "BOOKS.DEF"


GOSUB VERIFY.GOOD.LOAD
GOSUB GetCWD$
GOSUB GET.TARGET.DIR
POP.DIR$=CWD$
COMMAND$="CD:"+TargetDir$:GOSUB DOS.CMD
GOSUB CHECK.ERROR
ORIGBANK1=PEEK(0):ORIGBANK2=PEEK(1)

THEFILE$="SUMMARY.TXT"
F$=THEFILE$:GOSUB FILEEXISTS
IF FE% THEN OPEN.EDITOR

OPEN 7,DEVICE,7,"@:SUMMARY.TXT,S,W"
PRINT# 7, ""
PRINT# 7," * Blank Summary TXT *"
PRINT# 7, ""
PRINT# 7,"FOR: "+TargetDir$
CLOSE 7


OPEN.EDITOR:
COLOR 0,0:CLS
GOSUB DEFAULT.PALETTE
## X16 EDIT API, USE RAM BANKS STARING
## AT BANK 10
  POKE X.REG, 10
  POKE Y.REG, (SAVEBANK-5)
  P=POINTER(THEFILE$)
  POKE R0L, PEEK(P+1)
  POKE R0H, PEEK(P+2)
  POKE R1L, PEEK(P)
  BANK 0,13:SYS $C003

BANK ORIGBANK1,ORIGBANK2
COLOR 0,0:CLS
GOSUB SET.VGATextColors


COMMAND$="CD:"+POP.DIR$:GOSUB DOS.CMD
GOSUB CHECK.ERROR
PAD$=MyRootDir$
IF PAD$<>"/" THEN PAD$=PAD$+"/"
PROG$=PAD$+"BOOKMENU.PRG"
LOAD PROG$
END


CHECK.ERROR:
 IF FC$<>"OK" THEN WAS.ERROR
 RETURN

WAS.ERROR:
 PRINT
 PRINT "AN ERROR OCCURED:";FCode;", ";FC$
 PRINT
 END

Make.Temp.File:
  TmpNum = INT(RND(.)*100)+1
  TmpChar = INT(RND(.)*20)+65
  TmpChar$ = CHR$(TmpChar)
  TmpNum$ = STR$(TmpNum)
  TmpNum$ = MID$(TmpNum$,2)
  TmpFile.Prefix$ = TmpChar$+TmpNum$
  TmpFile$ = TmpFile.Prefix$ + "TMP.TMP"
  OPEN 9,DEVICE,9,"@:"+TmpFile$ + ",S,W"
  PRINT# 9, ""
  CLOSE 9
  GOSUB GETFILECODE
  TMP.SUCCESS=(FC$="OK")
RETURN

CHECK.FOR.FILE:
  OB = PEEK(0)
  BANK 0
  WORKBANK = PEEK($BFFE)
  BANK WORKBANK
  SAddr=$BD00:GOSUB PEEK.STRING
  THEFILE$=""
  File.TCheck = (S$="LOADFILE:")
  IF File.TCheck THEN SAddr=$BD10:GOSUB PEEK.STRING:THEFILE$=S$:S$="DONEREAD:":SAddr=$BD00:GOSUB POKE.STRING
  SAddr = $BE00:GOSUB PEEK.STRING
  LOAD.RETURN = (S$="MYLOADER:")
  IF LOAD.RETURN THEN SAddr=$BE10:GOSUB PEEK.STRING:My.Loader$=S$:POKE $BE00,.
  BANK OB
RETURN

DEFAULT.PALETTE:
  PAD$=MyRootDir$
  IF PAD$<>"/" Then PAD$=PAD$+"/"
  F$=PAD$+"DPAL.BIN":GOSUB FILEEXISTS
  IF FE% THEN BVLOAD F$,DEVICE,1,$FA00:RETURN
  POKE $9F20,00
  POKE $9F21,$FA
  POKE $9F22,%00010001
  V.DATA=$9F23
  RESTORE DEFPALDATA
  FOR I = 1 TO 512:READ C:POKE V.DATA, C:NEXT
  RETURN

DEFPALDATA:
 DATA 0,0,255,15,0,8,254,10,76,12,197,0,10,0,231,14,133,13,64,6,119,15,51,3,119,7,246,10,143,0,187,11,0,0,17,1,34,2,51,3,68,4,85,5,102,6,119,7,136,8,153,9,170,10,187,11,204,12,221,13,238
 DATA 14,255,15,17,2,51,4,68,6,102,8,136,10,153,12,187,15,17,2,34,4,51,6,68,8,85,10,102,12,119,15,0,2,17,4,17,6,34,8,34,10,51,12,51,15,0,2,0,4,0,6,0,8,0,10,0,12,0,15,33,2,67,4,100,6,134,8
 DATA 168,10,201,12,235,15,17,2,50,4,83,6,116,8,149,10,182,12,215,15,16,2,49,4,81,6,98,8,130,10,163,12,195,15,16,2,48,4,64,6,96,8,128,10,144,12,176,15,33,1,67,3,100,5,134,7,168,9,201,11,251
 DATA 13,33,1,66,3,99,4,132,6,165,8,198,9,247,11,32,1,65,2,97,4,130,5,162,6,195,8,243,9,32,1,64,2,96,3,128,4,160,5,192,6,240,7,33,1,67,3,101,4,134,6,168,8,202,9,252,11,33,1,66,2,100,3,133
 DATA 4,166,5,200,6,249,7,32,0,65,1,98,1,131,2,164,2,197,3,246,3,32,0,65,0,97,0,130,0,162,0,195,0,243,0,34,1,68,3,102,4,136,6,170,8,204,9,255,11,34,1,68,2,102,3,136,4,170,5,204,6,255,7,34
 DATA 0,68,1,102,1,136,2,170,2,204,3,255,3,34,0,68,0,102,0,136,0,170,0,204,0,255,0,18,1,52,3,86,4,104,6,138,8,172,9,207,11,18,1,36,2,70,3,88,4,106,5,140,6,159,7,2,0,20,1,38,1,56,2,74,2,92
 DATA 3,111,3,2,0,20,0,22,0,40,0,42,0,60,0,63,0,18,1,52,3,70,5,104,7,138,9,156,11,191,13,18,1,36,3,54,4,72,6,90,8,108,9,127,11,2,1,20,2,22,4,40,5,42,6,60,8,63,9,2,1,4,2,6,3,8,4,10,5,12,6
 DATA 15,7,18,2,52,4,70,6,104,8,138,10,156,12,190,15,17,2,35,4,53,6,71,8,89,10,107,12,125,15,1,2,19,4,21,6,38,8,40,10,58,12,60,15,1,2,3,4,4,6,6,8,8,10,9,12,11,15

REM 512  BYTES CONVERTED

#INCLUDE "BOOKS.BI"
